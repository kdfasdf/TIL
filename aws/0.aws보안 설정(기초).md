## 서론

- 학교에서 캡스톤 디자인을 하면서 aws를 사용했었는데 그 때 웹 관련 프로젝트는 처음 진행해보는거라 aws 사용하는 것도 쉽지 않았었다.
-  다시 개인프로젝트를 진행하면서 localhost에서만 프로젝트를 진행하는 것 보다는 aws를 통해 간단하게 배포해보는 것이 좋다고 생각해서
  오랜만에 aws를 이용하게 되었다.
  하지만 안타깝게도 aws 홈페이지에서 제공하는 정보들이 아직 나같은 초보자들에게는 어렵고 모호하게 설명되어 있는 부분이 많았다. 그래서 직접 간단한 설정을 하면서
  알게된 것들, 생긴 궁금증을 정리해보려고 한다 


  개인프로젝트를 하려고 aws 서비스를 이용하다 계정이 해킹당해 적게는 수백만원에서 많게는 수억원 정도의 청구서가 나오는 일에 대해 들어본적이 있을 것이다.
  aws가 처음 1회는 비용을 완전히 구제해주거나 일부 감면해주지만 아예 이런일이 일어나지 않도록 사전 예방하는 것이 더 중요하다.
  이러한 불상사를 예방하기 위해 aws 계정을 비교적 안전하게 관리하는 방법이 몇 가지 소개해보겠다(이미지 첨부 x 글로만 간단히)

참고로 aws 계정을 처음 만들 때 생성되는 계정은 root 계정이라고 한다 root 계정은 aws에서 제공하는 모든 서비스에 대해 접근 권한을 가지고 root 계정이 해킹당한다면 해커들이 여러 국가에 걸쳐 인스턴스를 생성하여 비트코인
채굴하는데 사용할 수 있으므로 root계정은 정말 철저히 관리해야한다.

  ## 1. MFA 설정
  
  - goolge authenticator 어플, 하드웨어 OTP를 이용한 OTP 서비스이다. iam유저는 몰라도 root 계정에 대해서는 꼭 설정 해두는 것이 좋다
     
      1. 우측 상단 계정 클릭
      2. 보안 자격 증명 클릭
      3. 멀티 팩터 인증 MFA 디바이스 할당 클릭
         
      이후 입력 칸에 맞게 모두 입력하면 설정이 된다 IAM유저 같은 경우 MFA코드를 실수로 삭제하거나 분실해도 root user가 IAM유저를 삭제할 수 있어서 큰 문제가 되지 않지만
    root user MFA를 실수로 잃어버리면 상당히 복잡한 과정을 거쳐서 계정을 복구해야하니까 조심해야한다.

##    2. IAM 유저 생성
      
  - IAM유저는 쉽게 말하면 모든 권한을 가진 root 계정과 다르게 일부 권한만 가지고 있는 유저이다. IAM 유저가 필요한 이유는 회사에서 어떤 프로젝트를 할 떄 개발부서는 ec2, db그룹은 rds 등 구분해서 관리할 수 있게 해주기 떄문이다.
    root계정에서 IAM 유저를 생성할 수 있고 권한정책을 부여할 수 있다. 필자는 생성해놓은 그룹이 없어서 권한 옵션에서 직접 정책 연결을 선택 했다

    1. 좌측 상단 검색에 IAM 검색
    2. 좌측 사용자 메뉴 선택
    3. 사용자 생성
    4. 권한 옵션에서 직접 옵션 선택 후 IAM 유저에 필요한 권한 부여
       - 필요한 용도에 따라 https://docs.aws.amazon.com/iam/에서 찾아서 추가하면 된다
       - 기본적으로 administratoraccess, IAMUserChangePassword 두개가 자동으로 추가되어 있는데 administratoraccess는 삭제하고(IAM 유저 생성, 관리 권한을 제외하고 거의 모든 권한을 IAM 유저한테 주는 정책임)
       - AmazonEC2FullAccess와, budget 작업 추가를 위해 AWSBudgetsActions_RolePolicyForResourceAdministrationWithSSM 권한을 부여했다.

##  3. Budgets 설정 

  - aws 에서는 내가 사용하는 서비스에 대해서 비용 알림 서비스를 이용할 수 있는데 그게 budget이다 월별 단위로 할 시 임계 비용에 대한 작업도 추가할 수 있다.
    필자는 IAM 유저 설정에 AWSBudgetsActions_RolePolicyForResourceAdministrationWithSSM을 추가하여 특정 비용이 넘어가면 ec2를 중단하도록 설정해놓았다
  
      1. 좌측 상단에서 budgets 검색
      2. 예산 생성
      3. 사용자 지정(임계비용 넘을 시 중단 작업을 위해) 후 다음
      4. 예산 이름 입력 이후 예산 금액 입력 후 다음
      5. 알림 임계값 설정 임계값, 이메일 수신자 입력
      6. 작업 추가 ->IAM 역할 수동 추가, AWSBudgetsActions_RolePolicyForResourceAdministrationWithSSM 추가 후 선택
      7. Automate instances to stop for EC2 or RDS 선택
      8. 리전 선택 후 자동 중단 할 EC2 혹은 RDS 선택
  
